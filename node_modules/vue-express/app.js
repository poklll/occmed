const Vue = require('vue')
var express = require('express')
var app = express()
const router = express.Router()

const renderer = require('vue-server-renderer').createRenderer()
var moduleRequire = require('./modules/require')
const Test = moduleRequire('./components/test.vue')

function serving(req, res) {
  global.styles = []
  const Test = moduleRequire('./components/test.vue')
  const app = new Vue({
      extends: Test,
      data: {
        url: req.url
      }
  })

  renderer.renderToString(app, (err, html) => {
    if (err) {
      console.error(err)
      res.status(500).end('Internal Server Error')
      return
    }
    const styles = global.styles || []
    console.log(styles.join('\n'))
    res.end(`
      <!DOCTYPE html>
      <html lang="en">
        <head><title>Hello</title></head>
        <body>${html}</body>
        <style>${styles.join('\n')}</style>
      </html>
    `)
  })
}

app.get('/', serving)
app.get('/home', serving)
app.get('/article', serving)
app.get('/tag', serving)

app.listen(8787)